# Система управления отоплением на базе роутера Keenetic

Система предназначена для включения/выключения радиаторов отопления по расписанию и показаниям датчиков температуры, работающих по радиоканалу. Также система записывает в базу данных показания температуры, давления и влажности. Управление системой и просмотр журнала показаний осуществляется через веб-интерфейс. Расписание может автоматически переключатся по признаку выходные/будни.  
Cистема представляет собой OpenWRT-пакет, и должна работать также на других роутерах с поддержкой Entware.  
Для управления радиаторами используются приводы от “теплого пола”, которые устанавливаются взамен терморегуляторов. Используются нормально закрытые приводы с управляющим напряжением 24 В.  
В качестве датчиков используются внешние датчики метеостанций BALDR, работающие на частоте 433 МГц. Датчики передают значения температуры и влажности.
Прием сигнала от датчиков и выдача напряжения на приводы осуществляется устройством на базе платы Arduino Nano.  
К плате Arduino подключены стандартные модули приемника 433 МГц, датчика температуры и давления BMP280, и управления нагрузкой.  
Плата Arduino по USB подключена к роутеру. Программа на роутере запускается по планировщику (cron) каждые 10 минут, считывает по протоколу Modbus значения температуры/давления/влажности и передает их в базу данных. Далее в БД формируется нужное состояние обогрева для комнаты, где расположен датчик. Программа на роутере вычитывает из базы состояние приводов радиаторов, и по Modbus включает/выключает выходы на плате Arduino.
Настройки системы, профили управления отоплением в комнатах хранятся в базе данных MariaDB. Запись журнала показаний в базу - опциональна, при ее отключении база данных будет работать в режиме Read-only, что может быть полезно в целях сохранения ресурса флеш-памяти и места на накопителе.
